<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
	    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCbczEzWpAR6LyeUTbMfnqLp1nOAfeMzik&sensor=FALSE">
    </script>
    <script type="text/javascript">
      globals = {};
      function loadEvictions() {
        $.getJSON('/reports/all_2013_now.json', function(data) {
            var items = [];
            var evictions = {};
            $.each(data, function(idx, val) {
		var locationkey = val["longitude"]+"-"+val["latitude"];
		if (!(locationkey in evictions)) {
		    evictions[locationkey] = [];
		};
		evictions[locationkey].push(val);
            });
	    $.each(evictions, function(key, vals) {
		var marker = new google.maps.Marker({
		    position: new google.maps.LatLng(
			vals[0]["latitude"], vals[0]["longitude"]),
		    map: globals["map"],
		    title: vals[0]["address"]
		});
	    });
	});
      }
      function initialize() {
          var mapOptions = {
              center: new google.maps.LatLng(37.7833, -122.4167),
              zoom: 13
          };
          globals["map"] = new google.maps.Map(
	      document.getElementById("map-canvas"),
              mapOptions);
	  loadEvictions();
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"/>
  </body>
</html>
